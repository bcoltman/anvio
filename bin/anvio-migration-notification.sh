#!/bin/bash
echo ""
echo "==============================================================================="
echo "       ðŸš¨ SORRY: YOU NEED TO REDO YOUR ANVI'O DEVELOPMENT ENVIRONMENT ðŸš¨"
echo "==============================================================================="
echo "TL;DR: If you run the following commands, you will most likely be fine, but"
echo "please consider reading the rest of this message:"
echo ""
echo "    cd ~/github/anvio"
echo "    pip install -e ."
echo ""
echo "Here is a more complete version of what is happening here. First, we are very"
echo "sorry for the inconvenience as we know that you don't have time for this kind"
echo "of stuff. And we are even more sorry because this is ONLY affecting anvi'o users"
echo "who are following the active development branch."
echo ""
echo "This is happening because we had to modernize the anvi'o packaging system, which"
echo "has not been touched for almost 10 years, to follow current Python best"
echo "practices. Previously, we kept anvi'o programs under \`bin/\` and \`sandbox/\`"
echo "directories in the codebase. That means, when you set up your anvi'o conda"
echo "environment to track the active codebase (i.e., anvio-dev), the conda activation"
echo "script had to set PATH variables in your terminal pionting these directories"
echo "so you could execute anvi'o programs directly from those directories in your"
echo "copy of the anvi'o code from GitHub. This strategy worked perfectly fine for"
echo "development, but it conflicted with modern Python packaging standards and created"
echo "issues when anvi'o needed to be installed in non-development environments or"
echo "distributed through standard Python packaging channels. As a result we decided"
echo "that it was time to bite the bullet, and have migrated all 160+ anvi'o programs"
echo "to use what we call "entry points" -- a modern Python mechanism where programs"
echo "are installed as proper commands that can find the latest code automatically."
echo "Very fancy indeed."
echo ""
echo "From now on setting up anvio-dev environemnts will use the pip command above,"
echo "rather than code that updates PATH and PYTHONPATH variables. We now have updated"
echo "our installation instructions to reflect that. And if you ran the pip command"
echo "above you should be golden: anvi'o programs should be running for you now, and"
echo "you will continue to get the latest anvi'o updates every time you activate your"
echo "conda environment, exactly as before. For the small fraction of users who are"
echo "also anvi'o developers, any changes you make to the anvi'o Python code will also"
echo "be immediately visible when you run anvi'o programs just like how it was before,"
echo "but now using modern Python infrastructure. The old \`bin/\` and \`sandbox/\`"
echo "directories are no longer in effect, and every anvi'o program and script is now"
echo "under \`anvio/cli\` directory. You are seeing this message when you run ANY anvi'o"
echo "program simply because we replaced the contents of every single program in the"
echo "\`bin/\` with this message so you can't miss this change (smart-guy-meme.jpg)."
echo ""
echo "Overall, this is a one-time migration that brings anvi'o up to current Python"
echo "packaging standards."
echo ""
echo "If you would like to see updated installation instructions for anvio-dev, please"
echo "visit:"
echo ""
echo "    https://anvio.org/install"
echo ""
echo "As always, anvi'o developers are thankful for your patience."
echo "==============================================================================="
